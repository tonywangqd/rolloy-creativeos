# Walker åˆ›æ„å·¥ä½œå°åŠŸèƒ½å®Œæ•´æ€§åˆ†ææŠ¥å‘Š

**äº§å“æ€»ç›‘å®¡æŸ¥æŠ¥å‘Š**
**æ—¥æœŸ**: 2025-12-23
**ç‰ˆæœ¬**: 1.0
**å®¡æŸ¥èŒƒå›´**: Walker å·¥ä½œå°ç”¨æˆ·åœºæ™¯ä¸åŠŸèƒ½ç¼ºå¤±åˆ†æ

---

## æ‰§è¡Œæ‘˜è¦ (Executive Summary)

Walker åˆ›æ„å·¥ä½œå°å½“å‰å¤„äº **MVP åŸå‹é˜¶æ®µ**ï¼Œæ ¸å¿ƒçš„ Prompt ç”Ÿæˆæµç¨‹å·²å®ç°ï¼Œä½†å­˜åœ¨ **ä¸¥é‡çš„åŠŸèƒ½ç¼ºå¤±**ï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•å®Œæˆå®Œæ•´çš„åˆ›æ„ç”Ÿæˆå·¥ä½œæµã€‚

### å…³é”®å‘ç° (Key Findings)

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | ä¸šåŠ¡å½±å“ |
|---------|------|---------|
| åˆ›æ„ç”Ÿæˆæµç¨‹ | ğŸŸ¡ éƒ¨åˆ†å¯ç”¨ | Prompt ç”Ÿæˆæ­£å¸¸ï¼Œä½†ç¼ºå°‘è¿­ä»£ä¼˜åŒ–æœºåˆ¶ |
| å›¾ç‰‡ç”Ÿæˆæµç¨‹ | ğŸ”´ å®Œå…¨ç¼ºå¤± | ç”¨æˆ·æ— æ³•åœ¨ç³»ç»Ÿå†…ç”Ÿæˆå›¾ç‰‡ |
| ä¼šè¯ç®¡ç†æµç¨‹ | ğŸ”´ å®Œå…¨ç¼ºå¤± | æ•°æ®æ— æ³•æŒä¹…åŒ–åˆ°äº‘ç«¯ |
| æ•°æ®æŒä¹…åŒ– | ğŸŸ¡ ä»…æœ¬åœ°å­˜å‚¨ | è·¨è®¾å¤‡è®¿é—®ä¸å¯ç”¨ |

**é£é™©ç­‰çº§**: ğŸ”´ HIGH - äº§å“æ— æ³•æ»¡è¶³åŸºæœ¬ç”¨æˆ·éœ€æ±‚

---

## ä¸€ã€åˆ›æ„ç”Ÿæˆæµç¨‹åˆ†æ

### 1.1 åœºæ™¯å‚æ•°é€‰æ‹© (ABCD Selector)

**çŠ¶æ€**: âœ… å·²å®ç°
**ä»£ç ä½ç½®**: `/app/walker/page.tsx` (Line 522)

**åŠŸèƒ½è¯„ä¼°**:
- âœ… æ”¯æŒ 5 ä¸ªç»´åº¦é€‰æ‹© (A1, A2, B, C, D)
- âœ… ä¸æ•°æ®åº“ ABCD Contexts é›†æˆ
- âœ… å®æ—¶éªŒè¯å¿…å¡«å­—æ®µ

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ æ— æ‰¹é‡å¯¼å…¥åœºæ™¯å‚æ•°åŠŸèƒ½
- âŒ æ— é¢„è®¾æ¨¡æ¿ (Templates) åŠŸèƒ½
- âŒ æ— åœºæ™¯å‚æ•°ç‰ˆæœ¬å†å²

**ä¸šåŠ¡ä»·å€¼æŸå¤±**:
- ç”¨æˆ·æ— æ³•å¤ç”¨æˆåŠŸçš„åœºæ™¯å‚æ•°ç»„åˆ
- å›¢é˜Ÿæ— æ³•å…±äº«æœ€ä½³å®è·µé…ç½®
- é‡å¤æ€§å·¥ä½œæ•ˆç‡ä½

---

### 1.2 Walker Prompt ç”Ÿæˆ

**çŠ¶æ€**: âœ… å·²å®ç°
**API**: `POST /api/walker/generate-prompt`
**ä»£ç ä½ç½®**: `/app/api/walker/generate-prompt/route.ts`

**åŠŸèƒ½è¯„ä¼°**:
- âœ… åŸºäº Gemini AI ç”Ÿæˆä¸“ä¸š Prompt
- âœ… æ”¯æŒ Walker çŠ¶æ€åˆ‡æ¢ (IN_USE / STORED)
- âœ… é›†æˆæ•°æ®åº“ AI Visual Prompts
- âœ… è‡ªåŠ¨ç”Ÿæˆåˆ›æ„å‘½å

**å·²éªŒè¯çš„æŠ€æœ¯èƒ½åŠ›**:
```typescript
// ä»£ç å¼•ç”¨: walker-gemini-service.ts (Line 257-306)
export async function generateWalkerPrompt(request: WalkerPromptRequest): Promise<WalkerPromptResponse> {
  // System Prompt ä½¿ç”¨ Walker ä¸“ç”¨é…ç½®
  const systemPrompt = await getWalkerSystemPrompt();

  // æ„å»ºåŒ…å«æ•°æ®åº“ AI Visual Prompts çš„ä¸Šä¸‹æ–‡
  const userPrompt = buildWalkerUserPrompt(
    request.selection,
    request.walkerState,
    request.contexts  // æ¥è‡ª Supabase æ•°æ®åº“
  );

  // è°ƒç”¨ Gemini API
  const result = await model.generateContent(userPrompt);
}
```

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ æ—  Prompt è¿­ä»£ä¼˜åŒ–æµç¨‹ (refinement workflow)
- âŒ æ—  A/B æµ‹è¯•æœºåˆ¶ (ç”Ÿæˆå¤šä¸ª Prompt å˜ä½“)
- âŒ æ—  Prompt è´¨é‡è¯„åˆ†ç³»ç»Ÿ

---

### 1.3 Prompt ç¼–è¾‘ä¸ä¼˜åŒ–

**çŠ¶æ€**: ğŸŸ¡ éƒ¨åˆ†å®ç°
**ä»£ç ä½ç½®**: `/app/walker/page.tsx` (Line 616-622)

**å·²å®ç°åŠŸèƒ½**:
- âœ… æ‰‹åŠ¨ç¼–è¾‘ Prompt æ–‡æœ¬
- âœ… Debounced è¾“å…¥ (300ms é˜²æŠ–)
- âœ… å¤åˆ¶åˆ°å‰ªè´´æ¿

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ **æ—  Prompt Refinement API** - æ— æ³•åŸºäºç”¨æˆ·åé¦ˆä¼˜åŒ– Prompt
- âŒ æ— ç‰ˆæœ¬å¯¹æ¯”å·¥å…· (Side-by-Side Comparison)
- âŒ æ— æ’¤é”€/é‡åš (Undo/Redo) åŠŸèƒ½
- âŒ æ— æ™ºèƒ½å»ºè®® (AI-powered suggestions)

**ä»£ç è¯æ®**:
```typescript
// walker/page.tsx (Line 91-94)
// Prompt refinement state - å£°æ˜äº†çŠ¶æ€ä½†æœªå®é™…ä½¿ç”¨
const [refinementInput, setRefinementInput] = useState("");
const [localRefinementInput, setLocalRefinementInput] = useState("");
const [isRefining, setIsRefining] = useState(false);
```

**ä¸šåŠ¡å½±å“**:
- ç”¨æˆ·åªèƒ½æ‰‹åŠ¨ç¼–è¾‘ï¼Œæ— æ³•è·å¾— AI è¾…åŠ©ä¼˜åŒ–
- æ— æ³•ç§‘å­¦åœ°è¿­ä»£æ”¹è¿› Prompt è´¨é‡
- å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œæ–°ç”¨æˆ·éš¾ä»¥ç”Ÿæˆé«˜è´¨é‡ Prompt

---

### 1.4 ä¸­æ–‡ç¿»è¯‘

**çŠ¶æ€**: âœ… å·²å®ç°
**API**: `POST /api/translate-prompt`
**ä»£ç ä½ç½®**: `/app/walker/page.tsx` (Line 410-430)

**åŠŸèƒ½è¯„ä¼°**:
- âœ… è°ƒç”¨ç¿»è¯‘ API
- âœ… æ˜¾ç¤ºä¸­æ–‡ç¿»è¯‘ç»“æœ
- âœ… åªè¯»æ˜¾ç¤º (é˜²æ­¢è¯¯ç¼–è¾‘)

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ æ— ç¿»è¯‘è´¨é‡åé¦ˆæœºåˆ¶
- âŒ æ— æœ¯è¯­åº“ (Glossary) ç®¡ç†
- âŒ æ— ç¿»è¯‘å†å²è®°å½•

---

### 1.5 è§†é¢‘ Prompt ç”Ÿæˆ

**çŠ¶æ€**: âœ… å·²å®ç°
**API**: `POST /api/generate-video-prompt`
**ä»£ç ä½ç½®**: `/app/walker/page.tsx` (Line 433-453)

**åŠŸèƒ½è¯„ä¼°**:
- âœ… åŸºäºå›¾ç‰‡ Prompt ç”Ÿæˆè§†é¢‘ Prompt
- âœ… åªè¯»æ˜¾ç¤º
- âœ… æ‰‹åŠ¨è§¦å‘ç”Ÿæˆ

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ æ— è§†é¢‘å‚æ•°é…ç½® (æ—¶é•¿ã€å¸§ç‡ã€åˆ†è¾¨ç‡)
- âŒ æ— è§†é¢‘åˆ†é•œè„šæœ¬ç”Ÿæˆ
- âŒ æ— è§†é¢‘ Prompt ç¼–è¾‘åŠŸèƒ½

---

## äºŒã€å›¾ç‰‡ç”Ÿæˆæµç¨‹åˆ†æ

### 2.1 å›¾ç‰‡ç”ŸæˆåŠŸèƒ½

**çŠ¶æ€**: ğŸ”´ **å®Œå…¨ç¼ºå¤± - ä¸¥é‡ä¸šåŠ¡é˜»å¡**

**ä»£ç è¯æ®**:
```typescript
// walker/page.tsx (Line 723-747)
<Card>
  <CardHeader>
    <CardTitle>Walker å›¾ç‰‡ç”Ÿæˆ</CardTitle>
    <p className="text-sm text-muted-foreground">
      Standard Walker å¹¿å‘Šå›¾ç‰‡ç”ŸæˆåŠŸèƒ½å¼€å‘ä¸­...
    </p>
  </CardHeader>
  <CardContent>
    <div className="flex flex-col items-center justify-center py-12 text-muted-foreground">
      <Footprints className="h-16 w-16 mb-4 opacity-50" />
      <p className="text-lg font-medium">Walker å›¾ç‰‡ç”Ÿæˆå³å°†æ¨å‡º</p>
      <p className="text-sm mt-2">
        è¯·ä½¿ç”¨ç”Ÿæˆçš„ Prompt åœ¨å¤–éƒ¨å›¾ç‰‡ç”Ÿæˆå·¥å…·ä¸­åˆ›å»º Walker å¹¿å‘Šå›¾ç‰‡
      </p>
    </div>
  </CardContent>
</Card>
```

**åç«¯æœåŠ¡å·²å®ç°ä½†æœªé›†æˆ**:
```typescript
// walker-gemini-service.ts (Line 386-467)
// å®Œæ•´çš„å›¾ç‰‡ç”Ÿæˆé€»è¾‘å·²å®ç°ï¼Œä½†å‰ç«¯æœªè°ƒç”¨
export async function generateWalkerImages(
  selection: ABCDSelection,
  numberOfImages: number = 4
): Promise<WalkerGenerationResult> {
  // å®Œæ•´å®ç°...
}

export async function generateWalkerImagesBatch(
  selection: ABCDSelection,
  numberOfImages: number = 20,
  onProgress?: WalkerProgressCallback
): Promise<WalkerGenerationResult> {
  // æ‰¹é‡ç”Ÿæˆå®ç°...
}
```

**ä¸šåŠ¡å½±å“åˆ†æ**:

| ç”¨æˆ·åœºæ™¯ | å½“å‰çŠ¶æ€ | é¢„æœŸè¡Œä¸º | ä¸šåŠ¡æŸå¤± |
|---------|---------|---------|---------|
| ç”Ÿæˆå¹¿å‘Šå›¾ç‰‡ | âŒ è·³è½¬åˆ°å¤–éƒ¨å·¥å…· | âœ… ç³»ç»Ÿå†…ä¸€é”®ç”Ÿæˆ | ç”¨æˆ·æµå¤± 100% |
| æ‰¹é‡ç”Ÿæˆ | âŒ ä¸å¯ç”¨ | âœ… 20-50 å¼ æ‰¹é‡ç”Ÿæˆ | æ— æ³•è§„æ¨¡åŒ–ä½¿ç”¨ |
| å®æ—¶é¢„è§ˆ | âŒ ä¸å¯ç”¨ | âœ… å³æ—¶æŸ¥çœ‹ç»“æœ | ç”¨æˆ·æ»¡æ„åº¦ä½ |
| è¿­ä»£ä¼˜åŒ– | âŒ ä¸å¯ç”¨ | âœ… ç”Ÿæˆ-è¯„ä¼°-å†ç”Ÿæˆ | åˆ›æ„è´¨é‡æ— ä¿éšœ |

**ç¼ºå¤±çš„å®Œæ•´åŠŸèƒ½åˆ—è¡¨**:
1. âŒ å›¾ç‰‡ç”Ÿæˆ API è·¯ç”± (`/api/walker/generate-images`)
2. âŒ å›¾ç‰‡ç”Ÿæˆ UI ç»„ä»¶ (æ‰¹é‡ç”Ÿæˆã€è¿›åº¦æ¡)
3. âŒ åœæ­¢/æš‚åœ/æ¢å¤ç”Ÿæˆæ§åˆ¶
4. âŒ å›¾ç‰‡é¢„è§ˆç½‘æ ¼ (Grid View)
5. âŒ å›¾ç‰‡ä¸Šä¼ åˆ° Supabase Storage
6. âŒ å›¾ç‰‡è¯„åˆ†ä¸ç­›é€‰åŠŸèƒ½
7. âŒ å›¾ç‰‡ä¸‹è½½åŠŸèƒ½ (å•å¼ /æ‰¹é‡)
8. âŒ å›¾ç‰‡æ”¾å¤§æŸ¥çœ‹ (Lightbox)

---

### 2.2 å›¾ç‰‡äº‘å­˜å‚¨

**çŠ¶æ€**: ğŸ”´ å®Œå…¨ç¼ºå¤±

**é—®é¢˜æè¿°**:
- ä»£ç ä¸­å®šä¹‰äº† `storageUrl` å­—æ®µï¼Œä½†æ— å®é™…ä¸Šä¼ é€»è¾‘
- Supabase Storage é…ç½®æœªåœ¨ Walker æ¨¡å—ä¸­ä½¿ç”¨

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ ä¸Šä¼ å›¾ç‰‡åˆ° Supabase Storage
- âŒ ç”Ÿæˆå…¬å¼€è®¿é—® URL
- âŒ å­˜å‚¨ç©ºé—´ç®¡ç†
- âŒ å›¾ç‰‡å»é‡æœºåˆ¶

---

### 2.3 å›¾ç‰‡è¯„åˆ†ä¸ç­›é€‰

**çŠ¶æ€**: ğŸ”´ å®Œå…¨ç¼ºå¤±

**ä»£ç è¯æ®**:
```typescript
// walker/page.tsx (Line 33-43)
interface GeneratedImage {
  id: string;
  url: string;
  storageUrl: string | null;
  selected: boolean;  // å­—æ®µå·²å®šä¹‰ä½†æœªä½¿ç”¨
  rating: number;     // å­—æ®µå·²å®šä¹‰ä½†æœªä½¿ç”¨
  status: "pending" | "generating" | "success" | "failed";
  aspectRatio?: string;
  resolution?: string;
  promptVersion?: number;
}
```

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ æ˜Ÿçº§è¯„åˆ† UI (1-5 æ˜Ÿ)
- âŒ å¤šé€‰åŠŸèƒ½ (Batch Select)
- âŒ æŒ‰è¯„åˆ†ç­›é€‰/æ’åº
- âŒ æ ‡è®°ä¸º"æœ€ä½³" (Mark as Best)

---

### 2.4 å›¾ç‰‡ä¸‹è½½

**çŠ¶æ€**: ğŸ”´ å®Œå…¨ç¼ºå¤±

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ å•å¼ å›¾ç‰‡ä¸‹è½½
- âŒ æ‰¹é‡ä¸‹è½½ (ZIP æ‰“åŒ…)
- âŒ æŒ‰è¯„åˆ†æ‰¹é‡å¯¼å‡º
- âŒ è‡ªå®šä¹‰æ–‡ä»¶å‘½åè§„åˆ™

---

## ä¸‰ã€ä¼šè¯ç®¡ç†æµç¨‹åˆ†æ

### 3.1 ä¼šè¯åˆ›å»ºä¸ä¿å­˜

**çŠ¶æ€**: ğŸ”´ **å®Œå…¨ç¼ºå¤± - ä¸¥é‡æ•°æ®ä¸¢å¤±é£é™©**

**ä»£ç è¯æ®**:
```typescript
// walker/page.tsx (Line 752-753)
{/* Right Sidebar - Session History (hidden for now) */}
{/* <SessionList sessions={sessions} onSelect={handleSessionSelect} /> */}
```

**é—®é¢˜åˆ†æ**:
1. `SessionList` ç»„ä»¶å·²å¯¼å…¥ä½†è¢«æ³¨é‡Šæ‰
2. è™½ç„¶å£°æ˜äº† `sessions` å’Œ `currentSessionId` çŠ¶æ€ï¼Œä½†ä»æœªè°ƒç”¨ä»»ä½• API
3. Supabase æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼Œä½† Walker æ¨¡å—æœªé›†æˆ

**åç«¯èƒ½åŠ›å·²å…·å¤‡**:
```typescript
// session-service.ts æä¾›å®Œæ•´çš„ä¼šè¯ç®¡ç†èƒ½åŠ›
export async function createSession(request: CreateSessionRequest)
export async function listSessions(query?: ListSessionsQuery)
export async function getSession(sessionId: string)
export async function updateSession(sessionId: string, updates: UpdateSessionRequest)
export async function deleteSession(sessionId: string)
```

**ç¼ºå¤±çš„é›†æˆå·¥ä½œ**:
1. âŒ è°ƒç”¨ `createSession` API ä¿å­˜å½“å‰åˆ›æ„
2. âŒ å®ç°"ä¿å­˜ä¼šè¯"æŒ‰é’®
3. âŒ å®ç°ä¼šè¯å…ƒæ•°æ®æ”¶é›† (åç§°ã€æè¿°)
4. âŒ å®ç°è‡ªåŠ¨ä¿å­˜æœºåˆ¶ (Auto-save)

---

### 3.2 ä¼šè¯å†å²æŸ¥çœ‹

**çŠ¶æ€**: ğŸ”´ å®Œå…¨ç¼ºå¤±

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ ä¼šè¯åˆ—è¡¨ UI (å³ä¾§è¾¹æ )
- âŒ ä¼šè¯æœç´¢åŠŸèƒ½
- âŒ ä¼šè¯æ’åº (æŒ‰æ—¶é—´ã€åç§°)
- âŒ ä¼šè¯çŠ¶æ€ç­›é€‰ (è‰ç¨¿/è¿›è¡Œä¸­/å·²å®Œæˆ)

---

### 3.3 åŠ è½½å†å²ä¼šè¯

**çŠ¶æ€**: ğŸ”´ å®Œå…¨ç¼ºå¤±

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ ç‚¹å‡»ä¼šè¯æ¢å¤æ‰€æœ‰çŠ¶æ€
- âŒ æ¢å¤ ABCD é€‰æ‹©
- âŒ æ¢å¤ Prompt ç‰ˆæœ¬å†å²
- âŒ æ¢å¤ç”Ÿæˆçš„å›¾ç‰‡

---

### 3.4 åˆ é™¤ä¼šè¯

**çŠ¶æ€**: ğŸ”´ å®Œå…¨ç¼ºå¤±

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
- âŒ çº§è”åˆ é™¤å…³è”å›¾ç‰‡
- âŒ æ‰¹é‡åˆ é™¤åŠŸèƒ½

---

## å››ã€æ•°æ®æŒä¹…åŒ–åˆ†æ

### 4.1 æœ¬åœ°å­˜å‚¨ (LocalStorage)

**çŠ¶æ€**: âœ… å·²å®ç°

**ä»£ç ä½ç½®**: `/app/walker/page.tsx` (Line 176-263)

**æŒä¹…åŒ–çš„æ•°æ®**:
- âœ… Prompt ç‰ˆæœ¬å†å² (`rolloy_walker_prompt_versions`)
- âœ… ç”Ÿæˆçš„å›¾ç‰‡ (ä»… `storageUrl`)
- âœ… ä¼šè¯é…ç½®æ•°æ® (ABCD é€‰æ‹©ã€Walker çŠ¶æ€ç­‰)

**ä¼˜ç‚¹**:
- åˆ·æ–°é¡µé¢æ•°æ®ä¸ä¸¢å¤±
- æ— éœ€ç½‘ç»œè¯·æ±‚ï¼Œå“åº”å¿«

**å±€é™æ€§**:
- âŒ è·¨è®¾å¤‡è®¿é—®ä¸å¯ç”¨
- âŒ æµè§ˆå™¨æ¸…é™¤ç¼“å­˜åæ•°æ®æ°¸ä¹…ä¸¢å¤±
- âŒ æ— æ•°æ®å¤‡ä»½æœºåˆ¶
- âŒ å­˜å‚¨ç©ºé—´é™åˆ¶ (çº¦ 5-10MB)

---

### 4.2 äº‘ç«¯åŒæ­¥ (Supabase)

**çŠ¶æ€**: ğŸ”´ å®Œå…¨ç¼ºå¤±

**æ•°æ®åº“æ¶æ„å·²å°±ç»ª**:
```sql
-- supabase/migrations/20251206_session_tables.sql
CREATE TABLE generation_sessions (...)
CREATE TABLE generated_images_v2 (...)
CREATE VIEW v_session_summary AS (...)
```

**æœªå®ç°çš„åŠŸèƒ½**:
1. âŒ Walker ä¼šè¯ä¿å­˜åˆ° `generation_sessions` è¡¨
2. âŒ Walker å›¾ç‰‡ä¿å­˜åˆ° `generated_images_v2` è¡¨
3. âŒ è·¨è®¾å¤‡å®æ—¶åŒæ­¥
4. âŒ ç¦»çº¿ä¼˜å…ˆ (Offline-first) æ¶æ„

**ä¸šåŠ¡å½±å“**:
- ç”¨æˆ·æ— æ³•åœ¨å¤šå°è®¾å¤‡ä¸Šå·¥ä½œ
- æ•°æ®å®‰å…¨æ€§æ— ä¿éšœ
- æ— æ³•å®ç°å›¢é˜Ÿåä½œ

---

### 4.3 æ•°æ®è¿ç§»ç­–ç•¥

**çŠ¶æ€**: âŒ ç¼ºå¤±

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ LocalStorage â†’ Supabase æ•°æ®è¿ç§»å·¥å…·
- âŒ æ•°æ®å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
- âŒ æ•°æ®ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†

---

## äº”ã€ç”¨æˆ·ä½“éªŒé—®é¢˜æ±‡æ€»

### 5.1 ä¸¥é‡æ€§é—®é¢˜ (Critical - P0)

| é—®é¢˜ | å½±å“ | å»ºè®®ä¼˜å…ˆçº§ |
|-----|-----|----------|
| æ— å›¾ç‰‡ç”ŸæˆåŠŸèƒ½ | ç”¨æˆ·æ— æ³•å®Œæˆæ ¸å¿ƒå·¥ä½œæµ | ğŸ”´ P0 - ç«‹å³ä¿®å¤ |
| æ— ä¼šè¯ä¿å­˜åŠŸèƒ½ | æ•°æ®éšæ—¶å¯èƒ½ä¸¢å¤± | ğŸ”´ P0 - ç«‹å³ä¿®å¤ |
| ä»…æœ¬åœ°å­˜å‚¨ | æ— æ³•è·¨è®¾å¤‡ä½¿ç”¨ | ğŸ”´ P0 - ç«‹å³ä¿®å¤ |

### 5.2 é«˜ä¼˜å…ˆçº§é—®é¢˜ (High - P1)

| é—®é¢˜ | å½±å“ | å»ºè®®ä¼˜å…ˆçº§ |
|-----|-----|----------|
| æ—  Prompt ä¼˜åŒ–æµç¨‹ | Prompt è´¨é‡ä¾èµ–æ‰‹åŠ¨è°ƒæ•´ | ğŸŸ  P1 - æœ¬å‘¨ä¿®å¤ |
| æ— å›¾ç‰‡è¯„åˆ†ç­›é€‰ | æ— æ³•é«˜æ•ˆç®¡ç†å¤§é‡å›¾ç‰‡ | ğŸŸ  P1 - æœ¬å‘¨ä¿®å¤ |
| æ— æ‰¹é‡ä¸‹è½½åŠŸèƒ½ | å¯¼å‡ºæ•ˆç‡ä½ | ğŸŸ  P1 - æœ¬å‘¨ä¿®å¤ |

### 5.3 ä¸­ä¼˜å…ˆçº§é—®é¢˜ (Medium - P2)

| é—®é¢˜ | å½±å“ | å»ºè®®ä¼˜å…ˆçº§ |
|-----|-----|----------|
| æ— ä¼šè¯æœç´¢åŠŸèƒ½ | å†å²è®°å½•éš¾ä»¥æŸ¥æ‰¾ | ğŸŸ¡ P2 - æœ¬æœˆä¿®å¤ |
| æ— å‚æ•°æ¨¡æ¿åŠŸèƒ½ | é‡å¤é…ç½®æ•ˆç‡ä½ | ğŸŸ¡ P2 - æœ¬æœˆä¿®å¤ |
| æ— æ•°æ®å¯¼å‡ºåŠŸèƒ½ | ç¼ºå°‘å¤‡ä»½æ–¹æ¡ˆ | ğŸŸ¡ P2 - æœ¬æœˆä¿®å¤ |

---

## å…­ã€åŠŸèƒ½å¯¹æ¯”ï¼šWalker vs Rollator

| åŠŸèƒ½æ¨¡å— | Rollator å·¥ä½œå° | Walker å·¥ä½œå° | å·®è· |
|---------|----------------|--------------|-----|
| Prompt ç”Ÿæˆ | âœ… å®Œæ•´å®ç° | âœ… å®Œæ•´å®ç° | æ— å·®è· |
| å›¾ç‰‡ç”Ÿæˆ | âœ… å®Œæ•´å®ç° | âŒ å®Œå…¨ç¼ºå¤± | **ä¸¥é‡å·®è·** |
| ä¼šè¯ç®¡ç† | âœ… å®Œæ•´å®ç° | âŒ å®Œå…¨ç¼ºå¤± | **ä¸¥é‡å·®è·** |
| äº‘ç«¯åŒæ­¥ | âœ… Supabase é›†æˆ | âŒ ä»…æœ¬åœ°å­˜å‚¨ | **ä¸¥é‡å·®è·** |
| å›¾ç‰‡è¯„åˆ† | âœ… 5 æ˜Ÿè¯„åˆ† | âŒ æœªå®ç° | **ä¸¥é‡å·®è·** |
| æ‰¹é‡ä¸‹è½½ | âœ… ZIP æ‰“åŒ… | âŒ æœªå®ç° | **ä¸¥é‡å·®è·** |

**ç»“è®º**: Walker å·¥ä½œå°åŠŸèƒ½å®Œæ•´åº¦çº¦ä¸º Rollator çš„ **30%**

---

## ä¸ƒã€æŠ€æœ¯å€ºåŠ¡æ¸…å•

### 7.1 ä»£ç å±‚é¢

1. **æœªä½¿ç”¨çš„çŠ¶æ€å˜é‡**
   ```typescript
   // walker/page.tsx
   const [refinementInput, setRefinementInput] = useState(""); // å£°æ˜ä½†æœªä½¿ç”¨
   const [sessions, setSessions] = useState<SessionSummary[]>([]); // ä»æœªæ›´æ–°
   const [currentSessionId, setCurrentSessionId] = useState<string | null>(null); // ä»æœªè®¾ç½®
   ```

2. **å·²å®ç°ä½†æœªé›†æˆçš„åç«¯åŠŸèƒ½**
   - `generateWalkerImages()` - å®Œæ•´å®ç°ä½†å‰ç«¯æœªè°ƒç”¨
   - `generateWalkerImagesBatch()` - å®Œæ•´å®ç°ä½†å‰ç«¯æœªè°ƒç”¨
   - `session-service.ts` - å®Œæ•´å®ç°ä½† Walker æ¨¡å—æœªä½¿ç”¨

3. **æ³¨é‡Šæ‰çš„å…³é”®ç»„ä»¶**
   ```typescript
   {/* <SessionList sessions={sessions} onSelect={handleSessionSelect} /> */}
   ```

### 7.2 æ¶æ„å±‚é¢

1. **æ•°æ®ä¸€è‡´æ€§é£é™©**
   - LocalStorage å’Œ Supabase æœªå»ºç«‹åŒæ­¥æœºåˆ¶
   - å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

2. **ç¼ºå°‘ API è·¯ç”±**
   - `/api/walker/generate-images` - ç¼ºå¤±
   - `/api/walker/sessions/*` - ç¼ºå¤±

3. **ç¼ºå°‘é”™è¯¯å¤„ç†**
   - ç½‘ç»œå¤±è´¥æ—¶æ— é‡è¯•æœºåˆ¶
   - æ— ç¦»çº¿é™çº§æ–¹æ¡ˆ

---

## å…«ã€äº§å“éœ€æ±‚å»ºè®® (MECE åŸåˆ™)

### 8.1 Phase 1: æ ¸å¿ƒåŠŸèƒ½è¡¥å…¨ (P0 - 2 å‘¨)

**ç›®æ ‡**: å®ç°å®Œæ•´çš„ MVF (Minimum Viable Features)

#### éœ€æ±‚ 1.1: Walker å›¾ç‰‡ç”Ÿæˆæµç¨‹

**User Story**:
> As a å¹¿å‘Šåˆ›æ„äººå‘˜
> I want to åœ¨ Walker å·¥ä½œå°å†…ç”Ÿæˆå¹¿å‘Šå›¾ç‰‡
> So that æˆ‘å¯ä»¥å¿«é€Ÿé¢„è§ˆåˆ›æ„æ•ˆæœï¼Œæ— éœ€ç¦»å¼€ç³»ç»Ÿ

**Acceptance Criteria** (Gherkin è¯­æ³•):
```gherkin
Given æˆ‘å·²å®Œæˆ Prompt ç”Ÿæˆ
When æˆ‘ç‚¹å‡»"ç”Ÿæˆå›¾ç‰‡"æŒ‰é’®
Then ç³»ç»Ÿåº”è°ƒç”¨ /api/walker/generate-images API
And æ˜¾ç¤ºæ‰¹é‡ç”Ÿæˆè¿›åº¦æ¡ (0-100%)
And æ¯ç”Ÿæˆä¸€å¼ å›¾ç‰‡ï¼Œå®æ—¶æ˜¾ç¤ºç¼©ç•¥å›¾
And ç”Ÿæˆå®Œæˆåï¼Œæ˜¾ç¤ºæˆåŠŸ/å¤±è´¥ç»Ÿè®¡
```

**æŠ€æœ¯è¦æ±‚**:
- åˆ›å»º API è·¯ç”±: `POST /api/walker/generate-images`
- é›†æˆå·²æœ‰çš„ `generateWalkerImagesBatch()` å‡½æ•°
- å®ç°è¿›åº¦å›è°ƒæœºåˆ¶
- æ”¯æŒåœæ­¢/æš‚åœ/æ¢å¤ç”Ÿæˆ

**æ•°æ®å¯è§†åŒ–éœ€æ±‚**:
- å›¾è¡¨ç±»å‹: è¿›åº¦æ¡ (Progress Bar) + å®æ—¶è®¡æ•°å™¨
- æ•°æ®æº: `WalkerBatchProgress` å¯¹è±¡
- æ›´æ–°é¢‘ç‡: æ¯ç”Ÿæˆä¸€å¼ å›¾ç‰‡æ›´æ–°ä¸€æ¬¡

#### éœ€æ±‚ 1.2: ä¼šè¯ä¿å­˜ä¸æ¢å¤

**User Story**:
> As a ç”¨æˆ·
> I want to ä¿å­˜æˆ‘çš„ Walker åˆ›æ„ä¼šè¯
> So that æˆ‘å¯ä»¥ç¨åç»§ç»­å·¥ä½œï¼Œæˆ–åœ¨å…¶ä»–è®¾å¤‡ä¸Šè®¿é—®

**Acceptance Criteria**:
```gherkin
Given æˆ‘å·²å®Œæˆ ABCD é€‰æ‹©å’Œ Prompt ç”Ÿæˆ
When æˆ‘ç‚¹å‡»"ä¿å­˜ä¼šè¯"æŒ‰é’®
Then ç³»ç»Ÿåº”ä¿å­˜ä»¥ä¸‹æ•°æ®åˆ° Supabase:
  | æ•°æ®å­—æ®µ | æ¥æº |
  | creative_name | ç”¨æˆ·è¾“å…¥æˆ–è‡ªåŠ¨ç”Ÿæˆ |
  | abcd_selection | å½“å‰ ABCD é€‰æ‹© |
  | prompt | å½“å‰ Prompt (å«ç‰ˆæœ¬å†å²) |
  | product_state | IN_USE æˆ– STORED |
  | reference_image_url | Walker å‚è€ƒå›¾ URL |
And æ˜¾ç¤º"ä¿å­˜æˆåŠŸ"æç¤º
And ä¼šè¯åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°
```

**Business Rules Matrix**:

| æ¡ä»¶ | æ“ä½œ | ç»“æœçŠ¶æ€ |
|-----|-----|---------|
| é¦–æ¬¡ä¿å­˜ | åˆ›å»ºæ–°ä¼šè¯ | `status = 'draft'` |
| å·²æœ‰ä¼šè¯ ID | æ›´æ–°ç°æœ‰ä¼šè¯ | `status = 'in_progress'` |
| ç”Ÿæˆå®Œæˆ | æ›´æ–°ä¼šè¯ | `status = 'completed'` |

#### éœ€æ±‚ 1.3: å›¾ç‰‡äº‘å­˜å‚¨

**User Story**:
> As a ç”¨æˆ·
> I want to ç”Ÿæˆçš„å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ åˆ°äº‘ç«¯
> So that æˆ‘å¯ä»¥éšæ—¶éšåœ°è®¿é—®å›¾ç‰‡ï¼Œä¸å ç”¨æœ¬åœ°å­˜å‚¨

**Acceptance Criteria**:
```gherkin
Given å›¾ç‰‡ç”ŸæˆæˆåŠŸ
When å›¾ç‰‡ç”Ÿæˆå®Œæˆ
Then ç³»ç»Ÿåº”è‡ªåŠ¨ä¸Šä¼ åˆ° Supabase Storage
And å­˜å‚¨è·¯å¾„æ ¼å¼ä¸º: walker/{session_id}/{image_index}.png
And ç”Ÿæˆå…¬å¼€è®¿é—® URL
And ä¿å­˜ URL åˆ° generated_images_v2 è¡¨
```

---

### 8.2 Phase 2: ç”¨æˆ·ä½“éªŒä¼˜åŒ– (P1 - 2 å‘¨)

#### éœ€æ±‚ 2.1: å›¾ç‰‡è¯„åˆ†ä¸ç­›é€‰

**User Story**:
> As a å¹¿å‘Šåˆ›æ„æ€»ç›‘
> I want to å¯¹ç”Ÿæˆçš„å›¾ç‰‡è¿›è¡Œè¯„åˆ†å’Œç­›é€‰
> So that æˆ‘å¯ä»¥å¿«é€ŸæŒ‘é€‰å‡ºæœ€ä½³åˆ›æ„

**Data Visualization Requirements**:
- **å›¾è¡¨ç±»å‹**: æ˜Ÿçº§è¯„åˆ†ç»„ä»¶ (Star Rating) + ç­›é€‰é¢æ¿
- **æ•°æ®æº**: `generated_images_v2.rating` å­—æ®µ (0-5)
- **Aggregation Rules**:
  - å¹³å‡è¯„åˆ† = SUM(rating) / COUNT(*)
  - é«˜åˆ†å›¾ç‰‡ = COUNT(rating >= 4)
- **äº¤äº’éœ€æ±‚**:
  - ç‚¹å‡»æ˜Ÿæ˜Ÿå³æ—¶æ›´æ–°è¯„åˆ†
  - ç­›é€‰æ¡ä»¶: æœªè¯„åˆ† / 1-2 æ˜Ÿ / 3-4 æ˜Ÿ / 5 æ˜Ÿ

#### éœ€æ±‚ 2.2: Prompt ä¼˜åŒ–æµç¨‹

**User Story**:
> As a æ–°æ‰‹ç”¨æˆ·
> I want to åŸºäºåˆå§‹ Prompt è¿›è¡Œ AI è¾…åŠ©ä¼˜åŒ–
> So that æˆ‘å¯ä»¥ç”Ÿæˆæ›´é«˜è´¨é‡çš„å›¾ç‰‡

**Acceptance Criteria**:
```gherkin
Given æˆ‘æœ‰ä¸€ä¸ªåˆå§‹ Prompt
When æˆ‘è¾“å…¥ä¼˜åŒ–éœ€æ±‚ (å¦‚"è®©åœºæ™¯æ›´æ¸©é¦¨")
Then ç³»ç»Ÿè°ƒç”¨ Gemini API ç”Ÿæˆä¼˜åŒ–åçš„ Prompt
And æ˜¾ç¤ºæ–°æ—§ Prompt å¯¹æ¯”è§†å›¾
And å…è®¸æˆ‘é€‰æ‹©ä½¿ç”¨æ–°ç‰ˆæœ¬æˆ–ä¿ç•™æ—§ç‰ˆæœ¬
And æ‰€æœ‰ç‰ˆæœ¬è‡ªåŠ¨ä¿å­˜åˆ° Prompt ç‰ˆæœ¬å†å²
```

---

### 8.3 Phase 3: é«˜çº§åŠŸèƒ½ (P2 - 3 å‘¨)

#### éœ€æ±‚ 3.1: ä¼šè¯åä½œåŠŸèƒ½

**User Story**:
> As a å›¢é˜Ÿæˆå‘˜
> I want to åˆ†äº«æˆ‘çš„ Walker åˆ›æ„ä¼šè¯
> So that å›¢é˜Ÿå¯ä»¥åä½œè¯„å®¡å’Œæ”¹è¿›

**Acceptance Criteria**:
```gherkin
Given æˆ‘æœ‰ä¸€ä¸ªå·²ä¿å­˜çš„ä¼šè¯
When æˆ‘ç‚¹å‡»"åˆ†äº«"æŒ‰é’®
Then ç³»ç»Ÿç”Ÿæˆå”¯ä¸€åˆ†äº«é“¾æ¥
And é“¾æ¥åŒ…å«ä¼šè¯åªè¯»è§†å›¾
And æ¥æ”¶è€…å¯æŸ¥çœ‹ ABCD é€‰æ‹©ã€Promptã€å›¾ç‰‡
And æ¥æ”¶è€…å¯å¤åˆ¶ä¼šè¯ä¸ºæ–°ä¼šè¯
```

#### éœ€æ±‚ 3.2: æ•°æ®åˆ†æä»ªè¡¨ç›˜

**User Story**:
> As a äº§å“ç»ç†
> I want to æŸ¥çœ‹ Walker åˆ›æ„ç”Ÿæˆçš„æ•°æ®ç»Ÿè®¡
> So that æˆ‘å¯ä»¥äº†è§£ç”¨æˆ·åå¥½å’Œç³»ç»Ÿæ€§èƒ½

**Data Visualization Requirements**:

**å›¾è¡¨ 1: ç”Ÿæˆè¶‹åŠ¿å›¾**
- ç±»å‹: æ—¶é—´åºåˆ—æŠ˜çº¿å›¾ (Time-series Line Chart)
- X è½´: æ—¥æœŸ (date)
- Y è½´: ç”Ÿæˆä¼šè¯æ•°é‡ (session_count)
- æ•°æ®æº: `generation_sessions.created_at`
- èšåˆè§„åˆ™: GROUP BY DATE(created_at), COUNT(*)

**å›¾è¡¨ 2: ABCD å‚æ•°åˆ†å¸ƒ**
- ç±»å‹: å †å æŸ±çŠ¶å›¾ (Stacked Bar Chart)
- ç»´åº¦: ABCD å„ç»´åº¦çš„é€‰é¡¹
- æŒ‡æ ‡: ä½¿ç”¨æ¬¡æ•° (usage_count)
- æ•°æ®æº: `generation_sessions.abcd_selection` (JSONB å­—æ®µ)
- èšåˆè§„åˆ™: JSONB å­—æ®µå±•å¼€ + COUNT(*)

**å›¾è¡¨ 3: å›¾ç‰‡è´¨é‡åˆ†å¸ƒ**
- ç±»å‹: é¥¼å›¾ (Pie Chart)
- ç»´åº¦: è¯„åˆ†ç­‰çº§ (æœªè¯„åˆ† / 1-2 æ˜Ÿ / 3-4 æ˜Ÿ / 5 æ˜Ÿ)
- æŒ‡æ ‡: å›¾ç‰‡æ•°é‡ (image_count)
- æ•°æ®æº: `generated_images_v2.rating`
- èšåˆè§„åˆ™:
  ```sql
  CASE
    WHEN rating = 0 THEN 'æœªè¯„åˆ†'
    WHEN rating BETWEEN 1 AND 2 THEN '1-2 æ˜Ÿ'
    WHEN rating BETWEEN 3 AND 4 THEN '3-4 æ˜Ÿ'
    WHEN rating = 5 THEN '5 æ˜Ÿ'
  END as rating_group,
  COUNT(*) as count
  ```

---

## ä¹ã€é£é™©è¯„ä¼°ä¸ç¼“è§£ç­–ç•¥

### 9.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|-----|------|------|---------|
| Gemini API é…é¢è¶…é™ | ä¸­ | é«˜ | å®ç°è¯·æ±‚é˜Ÿåˆ— + é€Ÿç‡é™åˆ¶ |
| Supabase Storage æ»¡å®¹ | ä½ | ä¸­ | å®šæœŸæ¸…ç† + å‹ç¼©å›¾ç‰‡ |
| å›¾ç‰‡ç”Ÿæˆå¤±è´¥ç‡é«˜ | ä¸­ | é«˜ | å®ç°é‡è¯•æœºåˆ¶ + é”™è¯¯æ—¥å¿— |

### 9.2 ä¸šåŠ¡é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|-----|------|------|---------|
| ç”¨æˆ·æœŸæœ›è½ç©º (åŠŸèƒ½ç¼ºå¤±) | é«˜ | é«˜ | é€æ˜åŒ–å¼€å‘è¿›åº¦ |
| æ•°æ®è¿ç§»å¤±è´¥ | ä½ | é«˜ | æä¾›æ•°æ®å¯¼å‡ºå·¥å…· |
| è·¨è®¾å¤‡æ•°æ®å†²çª | ä¸­ | ä¸­ | å®ç°å†²çªè§£å†³æœºåˆ¶ |

---

## åã€æˆåŠŸæŒ‡æ ‡ (KPIs)

### 10.1 åŠŸèƒ½å®Œæ•´æ€§æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ (Phase 1) | ç›®æ ‡å€¼ (Phase 3) |
|-----|--------|-----------------|-----------------|
| æ ¸å¿ƒåŠŸèƒ½è¦†ç›–ç‡ | 30% | 80% | 100% |
| ç”¨æˆ·å¯å®Œæˆå·¥ä½œæµæ¯”ä¾‹ | 0% | 90% | 100% |
| æ•°æ®æŒä¹…åŒ–æˆåŠŸç‡ | 0% (ä»…æœ¬åœ°) | 99.9% (äº‘ç«¯) | 99.99% |

### 10.2 ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|-----|--------|
| å›¾ç‰‡ç”Ÿæˆå®Œæˆç‡ | > 95% |
| å¹³å‡ä¼šè¯ä¿å­˜æ—¶é—´ | < 2 ç§’ |
| ä¼šè¯åŠ è½½æ—¶é—´ | < 1 ç§’ |
| ç”¨æˆ·æ»¡æ„åº¦è¯„åˆ† | > 4.5/5 |

---

## é™„å½•ï¼šæŠ€æœ¯æ¶æ„å»ºè®®

### A1. æ¨èçš„æŠ€æœ¯æ ˆæ•´åˆ

```
Frontend (Next.js)
  â”œâ”€ Walker Page (å·²æœ‰)
  â”œâ”€ æ–°å¢: Image Generation Panel
  â”œâ”€ æ–°å¢: Session Management Sidebar
  â””â”€ æ–°å¢: Rating & Filter Components

Backend (API Routes)
  â”œâ”€ /api/walker/generate-prompt (å·²æœ‰)
  â”œâ”€ æ–°å¢: /api/walker/generate-images
  â”œâ”€ æ–°å¢: /api/walker/sessions/*
  â””â”€ æ–°å¢: /api/walker/upload-image

Database (Supabase)
  â”œâ”€ generation_sessions (å·²æœ‰è¡¨ç»“æ„)
  â”œâ”€ generated_images_v2 (å·²æœ‰è¡¨ç»“æ„)
  â””â”€ æ–°å¢: walker_prompt_versions è¡¨

Storage (Supabase Storage)
  â””â”€ æ–°å¢: walker/ bucket
```

### A2. æ•°æ®æµå›¾

```
ç”¨æˆ·é€‰æ‹© ABCD
    â†“
ç”Ÿæˆ Prompt (Gemini API)
    â†“
ç”¨æˆ·ç¼–è¾‘/ä¼˜åŒ– Prompt
    â†“
ç”Ÿæˆå›¾ç‰‡ (Gemini Image API)
    â†“
ä¸Šä¼ åˆ° Supabase Storage
    â†“
ä¿å­˜ä¼šè¯åˆ° Supabase Database
    â†“
ç”¨æˆ·è¯„åˆ†/ç­›é€‰/ä¸‹è½½
```

---

**æŠ¥å‘Šç»“æŸ**

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. äº§å“å›¢é˜Ÿå®¡æŸ¥æœ¬æŠ¥å‘Šï¼Œç¡®è®¤ä¼˜å…ˆçº§
2. å·¥ç¨‹å›¢é˜Ÿè¯„ä¼° Phase 1 å·¥ä½œé‡ (é¢„ä¼° 2-3 å‘¨)
3. å¯åŠ¨ Agile Sprintï¼Œé€åŠŸèƒ½äº¤ä»˜

**æŠ¥å‘Šå®¡æ ¸äºº**: Product Director
**æŠ€æœ¯å®¡æ ¸äºº**: (å¾…æŒ‡å®š)
**æ‰¹å‡†çŠ¶æ€**: å¾…å®¡æ‰¹
